<html>

<title></title>

<body>

<button id="ajaxButton" type="button">Make a request</button>

<button id="ajaxButton1" type="button">Against Us</button>

<script>
  document.getElementById("ajaxButton").addEventListener('click', fetchData);

document.getElementById("ajaxButton1").addEventListener('click', notHam);

let returnVal;

function makeAjaxCall(url, methodType){
   var promiseObj = new Promise(function(resolve, reject){
      var xhr = new XMLHttpRequest();
	    if (!xhr) {
	      alert('Giving up :( Cannot create an XMLHTTP instance');
	      return false;
	    }
      xhr.open(methodType, url);
      xhr.setRequestHeader("Content-Type", "application/json");
      xhr.send(JSON.stringify({jsonrpc:"2.0",id:"1",  method:"say_hello"}));
      xhr.onreadystatechange = function(){
      if (xhr.readyState === 4){
         if (xhr.status === 200){
            resolve(xhr.responseText);
         } else {
            reject(xhr.status);
         }
      } else {
         console.log("xhr processing going on");
      }
   }
   
   console.log("request sent succesfully");
 });

 return promiseObj;
}


function fetchData(){
  var URL = 'http://127.0.0.1:3030/';
  makeAjaxCall(URL, 'POST').then(processResponse, errorHandler);

}

function processResponse(responseData) {
   returnVal = responseData;
   var respJson = JSON.parse(responseData);
   var resData = JSON.parse(respJson.result);
   alert(resData.sig1);
   alert(resData.sig2);
   alert(resData.pubkey);
   
}


function errorHandler(status) {
   alert("Bad Network or Spurious Request", status);
}


function notHam() {
   alert("Bad Network or Spurious Request", returnVal);
}
</script>


</body>
</html>
